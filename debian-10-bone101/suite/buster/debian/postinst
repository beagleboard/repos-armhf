#!/bin/sh
#
# see: dh_installdeb(1)

set -e

package="bone101"

npm_pkg_install () {
	echo "${package}:installing:[${npm_file}]"
	if [ ! -d /usr/local/lib/node_modules/ ] ; then
		mkdir -p /usr/local/lib/node_modules/ || true
	fi
	if [ -d /usr/local/lib/node_modules/${npm_project}/ ] ; then
		rm -rf /usr/local/lib/node_modules/${npm_project}/ || true
	fi

	echo "${package}:updating:[/usr/local/lib/node_modules/${npm_project}/]"
	tar xf /var/cache/${package}/${npm_file} -C /usr/local/lib/node_modules/
}

echo "Setting up: /var/lib/cloud9/ permissions"

if [ -d /var/lib/cloud9/ ] ; then
	chown -R 1000:1000 /var/lib/cloud9/ || true
	mv /var/lib/cloud9/dotc9 /var/lib/cloud9/.c9/
	mv /var/lib/cloud9/dotgit/ /var/lib/cloud9/.git/
	mv /var/lib/cloud9/dotgitignore /var/lib/cloud9/.gitignore

	echo "Updating Cloud9 examples from: https://github.com/beagleboard/cloud9-examples"
	cd /var/lib/cloud9/
	git config --global --add safe.directory /var/lib/cloud9
	git reset HEAD --hard
	git pull || true

	chown -R 1000:1000 /var/lib/cloud9/ || true
fi

if [ -d /usr/share/bone101/tmp/ ] ; then
	rm -rf /usr/share/bone101/tmp/ || true
fi

# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.

#DEBHELPER#

exit 0

